# 序章

## 0.1 Linuxカーネルとは

 * __イベント駆動型__
   * システムコール
   * 割り込み

## 0.1.1 UNIX の互換実装

 * __モノリシックカーネル__
 * __マイクロカーネル__
   * Mac OSX もだよ
     * XNU Kernel ___XNU's Not UNIX___
       * Mach microkernel
       * The BSD Layer (FreeBSD由来)
       * libKern
       * I/O Kit
 * マイクロカーネルの実例は???

#### System V の本

![71k140k5bfl _ss500_ gif](https://f.cloud.github.com/assets/172456/1985620/2e21f650-8441-11e3-9865-62d7b7871f15.jpeg)

#### Solaris Internals

![51jyl26gg-l](https://f.cloud.github.com/assets/172456/1985642/8275fcd8-8441-11e3-8eea-1f6a901dc27b.jpg)

#### 4.3BSD

![41okjaranfl _sl500_aa300_](https://f.cloud.github.com/assets/172456/1985643/84f1a764-8441-11e3-8a4a-521bbbf57f22.jpg)

## 0.2 Linuxカーネルのソースコード

 * バニラカーネルのダウンロード
   * https://www.kernel.org/
 * CentOS の kernel SRPM
   * http://vault.centos.org/ から探す
   * http://vault.centos.org/6.5/os/Source/SPackages/kernel-2.6.32-431.el6.src.rpm
 * CPUアーキテクチャの整理
   * ぎょーむ的には i386, x86_64 を中心に見る事になるのを確認

## 0.3 Linuカーネル機能の概要

## 0.4 カーネルプリミティブ

 * ___プリミティブ___ とは?
   * 基本機能?
 * ___非同期___
 
#### 0.4.1 プロセススケジューラ

__マルチタクス環境__

 * ___並列に実行されます___ と書いてるけど、マルチコア/マルチCPUが前提になっていて、並行の話が無いような
   * ___parallel___, ___concurrent___ を整理しよう
   * https://twitter.com/tnmt/status/318211278810275840
 * プロセスが___実行___される とは?
 * ___公平性、応答性、スループット___
   * どういうアルゴリズムにしたら理想なんだろうかを考えてみる (難しいけど)

#### 0.4.2 割り込み処理と遅延処理

 * ___割り込み___
   * ___Interrupt___
   * メタファとして、仕事中に急に呼びかけられて中断させられるという説明
   * コンテキストが変わる
   * http://www.cqpub.co.jp/interface/sample/200606/I0606147.pdf の図が分かりやすそう
 * ___ハードウェアからの事象___ とは? 何か例が無いと分かりにくそう
   * Ethernetカードにパケットが届いた
     * => パケットをコピーしないといけない
     * => 次のパケットに備えないといけない
     * 転送が遅い、パケットロス?
   * HDDの読み取りが終わった
     * => バッファにコピーしないといけない
     * => 次のHDDのコマンドに備えないといけない
     * I/O が遅い、重たい
   * マウス、キーボード
     * => スクロール、クリック、打鍵に応じて描画やキーボード入力
     * => 反応が遅い、イライラする
   * タイマ割り込み
     * インターバルの時間内に割り込み処理を完了しないと、次回の割り込みを取りこぼす
 * ___ソフト割り込み___
   * _割り込み処理を遅延させる仕組み_
 * ___割り込みレベル___
   * 低い優先度の割り込みをマスクする
   * 優先度の高い/低いの説明
     * 4.3BSD クロック割り込みの優先度は非常に高い
     * 他のほとんどの処理はブロックされる
     * ネットワークパケットのロス、ディスクヘッドのセクタ転送? を取りこぼしたりする可能性。"重要"

#### 0.4.3 時計

 * ___ハードウェアから一定周期で発生する割り込み___
 * ___時限処理___
   * _ネットワークプロトコルスタック、デバイスドライバが多用しています_
   * どんな風に?
     * TCP/IPのパケット再送, タイムアウトの実装
     * デバイスへのポーリング

#### 0.4.4 システムコール

P.96 の図を見た方がよい

 * ___Linuxカーネルコードの実行を開始します___
 * ___システムコールがプロセス間通信として実現されているOSも存在します___
   * Mach http://www.osrg.net/rtmach/publications/transtech-mach-3.pdf の例
 * ___プロセスのコンテキスト___
   * プロセスのコンテキストではないコンテキストとは?
   * 割り込みコンテキスト
 * ___保護機能___
   * [プロテクトモード](http://ja.wikipedia.org/wiki/プロテクトモード) <=> リアルモード
 * メモリ保護機能が無くて、Linuxカーネルのメモリを書き変えてしまったらどうなるか?
   * データの破壊, 整合性が狂う, ハードウェアの制御が出来ない, クラッシュ ... etc
 * ___CPUの実行レベル___

#### 0.4.5 同期と排他

 * synchronization, mutual execution
 * ___同一資源___
   * 何かサンプルは?
 * ___セマフォ___
 * ___スピンロック___
 * ___RCU___
 * ___シーケンスカウンタロック___

### 0.5 プロセス管理

 * ___プログラムの実行状態___
 * ___プロセス空間情報___
   * メモリのレイアウト P.25
 * ___制御端末___
   * telnetやSSHでのログイン => 仮想端末
   * コンソールからのログイン

#### 0.5.1 プロセス

 * ___ダイナミックリンクライブラリ___
   * ダイナミックリンカ (ld), 共有オブジェクトファイル (*.so)

#### 0.5.2 シグナル

 * ___非同期事象___
 * `man signal` で signal の一覧を見てみる
 * 似ているというか、ハードウェアからの割り込みモデルをソフトウェアで真似たのがシグナルのモデル
   * と 4.3BSD本に書いてある

#### 0.5.3

 * ___一種のプロセス___ とはどういうことか?
   * struct task_struct
 * ___POSIXスレッドインターフェイス___
   * pthread, 芋虫
   * 実装ではなく仕様/インターフェイス

### 0.6 メモリ管理

 * 実メモリ管理
   * PTEを解さないメモリ
 * ___仮想記憶___, ___仮想空間___
   * ps aux の VSZ

#### 0.6.1 実メモリ管理

 * ___ページ___
 ```sh
$ getconf PAGESIZE
```
 * CPUのアーキテクチャ依存
 * ___Buddyシステム___
   * ページの結合、断片化
 * ___Slabアトケータ__
 * テキストセグメントの ___書き込み保護___
   * 書き込もうとしたらどうなるか => SIGSEGV

#### 0.6.2 デマンドページング

### 0.7 ファイルシステム

 * ___バイトストリーム___
   * バイトストリームでないファイルとは?
 * ___デバイスやLinuxカーネル内のデータ構造もファイルとして扱える___
   * /dev, /sys, /proc 以下のこと?

#### 0.7.1 ファイル記述子

#### 0.7.2 キャッシュ機構

 * ___ページキャッシュ___
 * ___順次アクセス___
   * シーケンシャルリード
   * struct backing_dev_info
 * ___遅延させて2次記憶___
   * dirty なページの書き出し
   * generic_file_aio_write
 * ___inodeキャッシュ___
   * kmem_cache_alloc ?
   * dentryキャッシュ
     * dget, dput
